# Independent routing component from MOSS Framework

For licence details see Licence.md

# Registering routes
Each route is represented by ``RouteDefinition`` instance

	$Route = new \lib\router\RouteDefinition($domain, $pattern, $controller, $arguments, $forceDirs);

	$Router = new \lib\router\Router();
	$Router->register( $Route );

Where:

*   ``$domain`` defines domain or subdomain for pattern

*   ``$pattern`` is a regular expression, can include route variables eg. ``foo/{bar:\d}`` where variable ``bar`` can contain only digits

*   ``$controller`` controller/action identifier

*   ``$arguments`` by default its an empty array, when route should contain additional parameters, they should be passed as key-value pairs in this array

*   ``$forceDirs`` if true, subdomains will be converted into subdirectories in pattern (useful when you are to lazy to use virtual hosts in development)

Additionaly ``RouteDefinitions`` can be limited to concrete schema (protocol) and/or method via ``RouteDefinition::setSchema()`` and ``RouteDefinition::setMethod()``

# Resolving route
After route registration, router is ready to resolve incoming requests whitch are represented by ``Request`` object.

	$Request = new \lib\Request();
	$Router->match($Request);

If router finds matching route - updates ``Request`` object so it contains parameters defined in matching route definition.
If unable to match ``Request`` to route, ``RouteException`` will be thrown.

All data from incoming request and those received from route definition are available in Request object

# Generating link

When generating links, router finds first matching route and uses defined pattern to create url. If no routes matches passed parameters, normal url is generated.

	$url = $Request->make($controller, $arguments, $normal, $direct);

Where

*   ``$controller`` is same controller identifier whitch was passed to corresponding route definition

*   ``$arguments`` array containing required and additional arguments for route, additional arguments (those not included in pattern) will be added to generated link as query string

*   ``$normal`` if true, forces _normal_ link

*   ``$direct`` if true, forces direct link (by default direct links are generated, this can be canged in router class),

# Request object

Request object represents incoming requests.
Request properties:

*   ``xhr`` - if true, request was made by AJAX (had XMLHTTPRequest header - all modern libraries pass that header),

*   ``method`` - request method, if request is made via console - request method is set to ``CLI``,

*   ``schema`` - request protocol,

*   ``domain`` - requested host/domain,

*   ``dir`` - directory where request is handled,

*   ``referer`` - request referer,

*   ``baseName`` - server basename,

*   ``clientIP`` - clients IP address (or their proxy),

*   ``identifier`` - controllers identifier received from router,

*   ``url`` - requested URL without basename

*   ``self`` - full requested URL regenerated by router (can be used as cannonical)

*   ``invalidRedirect`` - by default is ``false``, when request was redirected from another directory, contains path differences,

*   ``cacheable`` - route definitions contain parameter defining if route can be cached by Gateway Caches/Reverse proxy

*   ``lang`` - two letter language identifier from controller identifier (set by Router when friendly link),

*   ``controller`` - controller name from controller identifier (set by Router when friendly link),

*   ``action`` - controllers action name from controller identifier (set by Router when friendly link),

*   ``headers`` - array containing request headers in key-value pairs

*   ``query`` - array containing request query parameters (those received from request and from route definition)

*   ``post`` - array containing post parameters



